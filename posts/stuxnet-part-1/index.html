<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Deep Dive on Stuxnet Weapon Part 1</title>
<meta name=description content="In this article, we delve into the analysis of Stuxnet, a malware that captured the attention of malware analysts and security experts for years, particularly …"><meta name=keywords content='blog,gokarna,hugo,Red Team,Malware Analysis,ICS,SCADA'><meta property="og:url" content="https://binophism.github.io/posts/stuxnet-part-1/"><meta property="og:type" content="website"><meta property="og:title" content="Deep Dive on Stuxnet Weapon Part 1"><meta property="og:description" content="In this article, we delve into the analysis of Stuxnet, a malware that captured the attention of malware analysts and security experts for years, particularly …"><meta property="og:image" content="https://avatars.githubusercontent.com/u/63192240?v=4"><meta property="og:image:secure_url" content="https://avatars.githubusercontent.com/u/63192240?v=4"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Deep Dive on Stuxnet Weapon Part 1"><meta name=twitter:description content="In this article, we delve into the analysis of Stuxnet, a malware that captured the attention of malware analysts and security experts for years, particularly …"><meta property="twitter:domain" content="https://binophism.github.io/posts/stuxnet-part-1/"><meta property="twitter:url" content="https://binophism.github.io/posts/stuxnet-part-1/"><meta name=twitter:image content="https://avatars.githubusercontent.com/u/63192240?v=4"><link rel=canonical href=https://binophism.github.io/posts/stuxnet-part-1/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.893af8dd3b65bd0ffe90e7af33847bd6dc9180b8fa6d6659a212a6f4b62d3e01.js integrity="sha256-iTr43TtlvQ/+kOevM4R71tyRgLj6bWZZohKm9LYtPgE="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://binophism.github.io/><img src='https://avatars.githubusercontent.com/u/63192240?v=4' alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://binophism.github.io/>Mohammad Mahdi Anbaraki</a></div><div class=nav-links><div class=nav-link><a href=https://binophism.github.io/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://binophism.github.io/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://binophism.github.io/projects/><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://binophism.github.io/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/binophism><span data-feather=github></span></a></div><div class=nav-link><a href=https://binophism.github.io/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target"></span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://binophism.github.io/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://binophism.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://binophism.github.io/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://binophism.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/binophism><span data-feather=github></span></a></li><li class=nav-item><a href=https://binophism.github.io/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Deep Dive on Stuxnet Weapon Part 1</h1><small role=doc-subtitle>In this article, we delve into the analysis of Stuxnet, a malware that captured the attention of malware analysts and security experts for years, particularly in the field of SCADA systems. In the first section, we examine targeted attacks, their characteristics, and the objectives they pursue. In the second section, we provide general information about SCADA systems and their components, with a focus on PLCs, which were one of Stuxnet's primary targets. The third section discusses how this worm propagated and the vulnerabilities it exploited to infect its targets. Finally, in the concluding section, we analyze the anatomy of Stuxnet, including aspects such as its user-mode and kernel-mode components, the RPC server, and more.</small><p class=post-date>December 19, 2024</p><ul class=post-tags><li class=post-tag><a href=https://binophism.github.io/tags/red-team>Red Team</a></li><li class=post-tag><a href=https://binophism.github.io/tags/malware-analysis>Malware Analysis</a></li><li class=post-tag><a href=https://binophism.github.io/tags/ics>ICS</a></li><li class=post-tag><a href=https://binophism.github.io/tags/scada>SCADA</a></li></ul></div><div class=post-content><h2 id=examining-targeted-attacks>Examining Targeted Attacks</h2><p>Targeted attacks are generally divided into two categories:</p><h3 id=1-targeting-a-specific-organization-or-company>1. Targeting a Specific Organization or Company</h3><p>This type of targeted attack focuses on a specific organization, with the attacker aiming to gain access to confidential information, such as business documents. A notable example of this is the Aurora attack.</p><h3 id=2-targeting-specific-software-or-technological-infrastructure>2. Targeting Specific Software or Technological Infrastructure</h3><p>Unlike the first category, this type of attack is not directed at a specific organization but rather at the data of specific software. For instance, banking applications or SCADA systems are common targets. These attacks are usually highly flexible and, notably, have a greater potential for damage compared to the first category. This is because the attacker can infiltrate more than one organization. These attacks are often long-term in nature, requiring careful planning to bypass security systems and achieve their objectives. Stuxnet is a prime example of such an attack.</p><h3 id=common-vectors-for-external-targeted-attacks>Common Vectors for External Targeted Attacks</h3><p>The most common vector for external targeted attacks is exploiting vulnerabilities in popular client-side applications, such as web browsers. Typically, attackers achieve their goals after progressing through several phases to gain access to their targets.</p><p><img src=/images/client_side_attack.png alt="Typical Phases of Client-Side Attacks"></p><p>One of the main and critical objectives of malware in targeted attacks is the ability to bypass security mechanisms. It is worth noting that one of the business sectors of cybercriminals is the sale of tools that assist malware in staying hidden from security mechanisms, such as antivirus software.</p><p><img src=/images/malware_crypter.jpg alt></p><p>The use of this approach extends the lifespan of older malware and increases the period during which they remain undetected by security products. It is important to note, however, that malware does not always employ these technologies; in some cases, instead of using techniques to bypass security products like antivirus software, they try to make their actions appear as legitimate programs (Stuxnet also utilized this approach).</p><p>The Stuxnet attack raised doubts about the trustworthiness of programs that had legitimate digital signatures, and it also made it easier for security products that followed whitelisting mechanisms to be bypassed. This is because, by default, security products did not scrutinize files with valid digital signatures and trusted them. As previously mentioned, instead of using specific techniques to bypass security products, Stuxnet attempted to present itself as legitimate software, achieving this by using a valid digital signature from a trusted company.</p><p>Moreover, Stuxnet exploited a zero-day vulnerability that was executed automatically, enabling it to spread across target systems. All of these factors indicate a targeted, long-term attack.</p><hr><h2 id=stuxnet-worm-spread-statistics>Stuxnet Worm Spread Statistics</h2><p>The image below shows the global spread statistics of the Stuxnet worm from the time it was identified until September of the same year.</p><p><img src=/images/stuxnet_infection.png alt></p><p>As seen, Asian countries have the highest infection rates, with Iran showing the most significant spread of Stuxnet. The image below illustrates the infection levels in other countries.</p><p><img src=/images/stuxnet_infection_2.png alt></p><p>A high volume of infection and spread of a malware in a region can indicate that the region is the primary target of the attack. However, there may also be other potential targets, and the reckless nature of the infection mechanism may hint at the specifics of the targeting. Although the highest detection and infection of Stuxnet was reported in Iran, it cannot be conclusively stated that Iran was the only target of this attack. More precisely, Iran was the primary target, and in the next phase, damaging nuclear sites in other Middle Eastern countries was also considered. Additionally, the widespread and self-replicating nature of the malware led to more systems being infected.</p><hr><h2 id=fundamental-concepts-of-scada-systems>Fundamental Concepts of SCADA Systems</h2><p>Supervisory Control and Data Acquisition (SCADA) refers to large-scale control and measurement systems. Typically, SCADA refers to a central system that monitors and oversees a site or extensive system across wide distances (up to several kilometers).<br>In a SCADA system, the control room can issue necessary commands based on the obtained data. Additionally, this data is stored in a data logging system or database management system, which often includes graphing and analysis capabilities.</p><p>SCADA systems are used to monitor or control processes such as chemical processing, transportation, urban water supply systems, electricity generation and distribution control, and in oil and gas pipelines, as well as other large and distributed processes.</p><p><img src=/images/scada_system.png alt="SCADA System Schematic"></p><p>In summary, all systems used in nuclear power plants, air defense control networks, power plants, water, gas, oil, transportation, banks, and communication infrastructure systems, as well as systems controlling the status and physical functions of other systems, are called critical infrastructure systems.<br>In earlier decades, these systems were physically isolated from others and controlled mechanically. Today, however, all of them and their controlling infrastructure can be connected to the internet, which introduces a significant security risk (on a national level). But why can connecting these types of systems to a network be dangerous? Unfortunately, when examining the security mechanisms designed to protect the information in industrial systems, we find that, unlike computer systems with numerous defined and implemented security protocols, industrial systems have minimal security measures in place.<br>The most important part of a critical infrastructure system is its network control system. The network control system collects real-time information about the system&rsquo;s status and communicates the system&rsquo;s status on a map to the operator through an understandable graphical interface.<br>Critical infrastructure systems can include large systems such as a Smart Grid Network or smaller units such as a Phasor Measurement Unit (PMU) in a power transmission network, a PLC controlling steam or refrigeration in a power plant, or a remote measurement unit/sensor in a small manufacturing plant.<br>In this paper, we will explore how a critical system can change from one network to another. Another critical part of vital systems is the control system, which is referred to as the Industrial Control System (ICS).</p><h4 id=scada-system-components>SCADA System Components</h4><p>If you study the concept of systems, you will realize that the foundation of the world consists of systems. Each system has an input, processes it, and produces an output. Every system is composed of various components that interact with each other. In the case of SCADA systems, we are dealing with a system composed of several components, which are interconnected. A SCADA system consists of the following components:</p><ol><li><p><strong>Sensors and Actuators</strong>: Sensors measure physical parameters such as pressure, temperature, flow rate, levels, and proximity. These signals are then converted to binary form to make them understandable to computers. Common industrial sensors include resistive detectors (RTUs), thermocouples, etc.</p></li><li><p><strong>Human-Machine Interface (HMI)</strong>: The HMI acts as a bridge between the operator and the machine, allowing the operator to easily view all system data (both new and old) in the form of schematics, KPI dashboards, and reports. In other words, the operator can easily view system information and interact with and control the system. HMIs provide warnings to inform the operator in case of anomalies or security breaches in the SCADA system.</p></li><li><p><strong>Historian</strong>: A historian is an optimized database used to store large volumes of industrial time-series data. It collects data from field devices such as sensors and continuously updates parameters and events. The speed of data collection and retrieval in historians is higher than in conventional databases like MySQL.</p><ul><li><strong>Time Series</strong>: A time series refers to a sequence of observations arranged in chronological order. Simply put, it refers to the continuous observation of a variable over time, such as the temperature of a boiler, where the temperature is recorded in a database in chronological order.</li></ul></li><li><p><strong>Remote Terminal Units (RTUs)</strong>: RTUs are field controllers based on microprocessors that communicate directly with sensors and actuators. They collect telemetry data from sensors and then transmit it to the central SCADA server via communication networks. RTUs also receive and execute control commands from the central ICS system.</p></li><li><p><strong>Programmable Logic Controllers (PLCs)</strong>: PLCs are industrial computers primarily responsible for controlling and automating industrial processes. PLCs process input signals from field devices such as sensors and send appropriate output signals to control actuators such as valves, motors, and switches. For example, a PLC may receive the temperature of a boiler as input and decide to perform a specific action when the temperature reaches 400°C.</p></li><li><p><strong>Master Terminal Unit (MTU)</strong>: The MTU serves as the central server for the SCADA system, containing both hardware and software layers. MTUs collect telemetry data from field devices, perform necessary processing, and store the data. They also display information to the operator through the HMI and can send control commands to field devices via PLCs and RTUs.</p></li><li><p><strong>Data Communication Infrastructure</strong>: This component connects different devices in a SCADA system. In the past, before the advent of Fieldbus controllers, devices and controllers were connected using RS-232 serial communication, which had the limitation that only two devices could communicate. Today, with Fieldbus connections, multiple devices (field devices) can connect to a controller (PLC).</p></li></ol><h3 id=deep-dive-into-the-purdue-model>Deep Dive into the Purdue Model</h3><p>The Purdue Model, also known as the Purdue Enterprise Reference Architecture (PERA), is a reference model designed for data flows in fully automated factories. It serves as a standard for constructing the network architecture of Industrial Control Systems (ICS) that also supports OT security. This model separates network layers, creating a hierarchical flow of data between each section. In other words, it separates physical processes, sensors, supervisory controls, operations, and logistics. The Purdue Model acts as a key framework for segmenting ICS networks to protect Operational Technologies (OT) from malware and other attacks.</p><p><img src=/images/Purdue.png alt="Purdue Model Diagram"></p><p>As seen, this model has six components that include both Information Technology (IT) and OT systems. When these components are properly implemented, they create an air gap between ICS/OT and IT systems, effectively isolating them. The benefit of this separation is that organizations can easily control access without disrupting the performance of other systems, ensuring the proper structure and architecture of ICS systems are maintained.</p><p>In the Purdue Model, OT systems, which include operational processes, are located at the lower levels, while IT systems, related to information technology, are situated at higher levels. Between these two levels, there is a segment known as the <strong>Demilitarized Zone (DMZ)</strong>, whose primary function is to create a security layer to protect communications between IT and OT networks, facilitating data exchange between the two levels.</p><p>Now, let&rsquo;s examine each level of this model from top to bottom.</p><ul><li><p><strong>Level 4/5 (Organizational):</strong> This level encompasses IT networks, including services such as web services, email systems (email servers), and Enterprise Resource Planning (ERP) systems. The ERP section manages production systems and executes processes like factory production planning, material usage, and transportation. It&rsquo;s important to note that any disruption at this level could result in significant economic losses.</p></li><li><p><strong>Level 3.5 (DMZ):</strong> This section serves as a layer between IT and OT and includes security systems like firewalls and proxies. The goal of this layer is to prevent lateral movement of attackers between IT and OT networks. Increasing automation needs have led to the creation of bi-directional data flows between OT and IT layers. It’s also worth mentioning that if an organization’s network architecture is flat, it can increase the cybersecurity risks. At this level, OT-based devices with Linux and Windows operating systems are present, and services like WSUS (Windows Server Update Services) can be used for patch management of OT Windows devices.</p></li><li><p><strong>Level 3 (Production Operations System Area):</strong> This area contains custom OT devices that manage the flow of factory production. This section includes:</p><ul><li><strong>Manufacturing Operations Management (MOM):</strong> This system manages the operations (processes) of production.</li><li><strong>Manufacturing Execution Systems (MES):</strong> This system collects real-time data, resulting in product optimization.</li><li><strong>Historian Data:</strong> In addition to storing process data over time, it performs contextual analysis. For example, modern systems can compare and analyze temperature or steam data with similar data from a specific time series or under particular conditions to identify potential problems.</li></ul></li><li><p><strong>Level 2 (Control Systems Area):</strong> This region includes systems designed for monitoring, controlling, and supervising physical processes. Systems in this area include Distributed Control Systems (DCS), SCADA (Supervisory Control and Data Acquisition) software, and Human-Machine Interfaces (HMI).</p></li><li><p><strong>Level 1 (Intelligent Devices Area):</strong> This section includes devices such as PLCs (Programmable Logic Controllers) and RTUs (Remote Terminal Units) that send commands to devices at level 0.</p></li><li><p><strong>Level 0 (Physical Process Area):</strong> This section includes physical processes like sensors (e.g., temperature and pressure sensors). Modern sensors often communicate through cellular networks and connect with monitoring software deployed in cloud environments.</p></li></ul><h4 id=features-of-site-scada-and-regional-scada>Features of Site SCADA and Regional SCADA</h4><p>Manufacturing industries often use the term <strong>Site SCADA</strong> for their supervisory systems, while <strong>Regional SCADA</strong> refers to supervisory and control systems used to manage critical infrastructure over a wide geographical area. To summarize the distinction between Site SCADA and Regional SCADA, it primarily comes down to <strong>geographical scale</strong>. Site SCADA is typically used for monitoring and controlling a specific site or a small geographical area.</p><p>Now, let&rsquo;s explore the features and standards associated with Site SCADA and Regional SCADA:</p><ul><li>SCADA systems are based on <strong>TCP/IP technology</strong>.</li><li>SCADA systems usually use <strong>standard protocols</strong>, meaning they typically use protocols supported by all vendors.</li><li>Both systems are located at <strong>Level 3</strong> of the Purdue model.</li></ul><h4 id=dcs-overview>DCS Overview</h4><p>Distributed Control Systems (<strong>DCS</strong>) became popular in 1975 and remain one of the most widely used systems to this day. The popularity of these systems can be attributed to increased accessibility, advances in computers, and the widespread use of microprocessors in process control. It is worth noting that DCS includes distributed digital controllers, which, due to their functional or geographical distribution, allow complex processes to be efficiently controlled and managed.</p><p>Distributed control systems typically use proprietary controllers, protocols, and connections. The DCS units are placed at <strong>Level 1</strong> of the Purdue model and are directly connected to physical equipment such as switches, pumps, etc., located at <strong>Level 0</strong> of the Purdue model. DCS units are also connected to <strong>HMIs</strong>, which are located at <strong>Level 2</strong> of the Purdue model.</p><p>DCS are used in complex processes that involve multiple operators. As mentioned earlier, distributed control systems are essentially a type of proprietary system, often used in continuous and large-scale production processes such as oil refining, electricity generation, fertilizer production, pharmaceuticals, cement manufacturing, and more.</p><p>DCS systems connect to sensors and actuators to control material flow in a factory. Modern DCS units also support neural networks and fuzzy logic applications.</p><p><img src=/images/DCS.png alt="DCS Diagram"></p><h4 id=industrial-control-systems-ics>Industrial Control Systems (ICS)</h4><p>Industrial Control Systems (ICS) typically include various types of control systems, such as Supervisory Control and Data Acquisition (SCADA) systems, Distributed Control Systems (DCS), and Programmable Logic Controllers (PLC). ICS are widely used in nuclear power plants, power plants, electricity distribution networks, oil and gas systems, as well as in transportation, defense industries, waste collection, and even automotive manufacturing. ICS are systems that do not require a human operator to perform their tasks. In some types of ICS, the control network is physically isolated, forcing the system to communicate with other control stations via a network.</p><p>There are two key components in Industrial Control Systems (ICS) whose functions are interrelated: SCADA systems and Programmable Logic Controllers (PLC). SCADA systems are designed to provide real-time information to a human operator and can offer information on the current state of physical processes, as well as the ability to make changes to the process remotely. SCADA systems are widely distributed in industry today and are geographically separated from centralized data collection systems.</p><p>In a Distributed Control System (DCS), SCADA systems usually control multiple interactive systems, each responsible for a local process. DCS are widely used in industries based on physical processes. On the other hand, a PLC is an embedded computer-based system that can control industrial equipment or processes and can also organize the execution flow of processes. PLC systems are commonly used along with SCADA systems to execute operator-supervised operations.</p><p>The first ICS systems in 1977 could not connect to an external network; however, they had the ability to connect to a local network with a closed control environment and proprietary protocols. Modern ICS, however, fully support the TCP/IP protocol stack, run on real-time operating systems, and can connect to the global internet.</p><p>Due to this, we will face many security issues in the future for ICS. Industrial Control Systems (ICS) are a critical part of vital infrastructure, so the emergence of a security issue in ICS can directly impact the infrastructure systems.</p><hr><h3 id=reference>Reference</h3><p><a href=https://www.zscaler.com/resources/security-terms-glossary/what-is-purdue-model-ics-security>What is Purdue Model ICS Security</a></p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#examining-targeted-attacks>Examining Targeted Attacks</a><ul><li><a href=#1-targeting-a-specific-organization-or-company>1. Targeting a Specific Organization or Company</a></li><li><a href=#2-targeting-specific-software-or-technological-infrastructure>2. Targeting Specific Software or Technological Infrastructure</a></li><li><a href=#common-vectors-for-external-targeted-attacks>Common Vectors for External Targeted Attacks</a></li></ul></li><li><a href=#stuxnet-worm-spread-statistics>Stuxnet Worm Spread Statistics</a></li><li><a href=#fundamental-concepts-of-scada-systems>Fundamental Concepts of SCADA Systems</a><ul><li><ul><li><a href=#scada-system-components>SCADA System Components</a></li></ul></li><li><a href=#deep-dive-into-the-purdue-model>Deep Dive into the Purdue Model</a><ul><li><a href=#features-of-site-scada-and-regional-scada>Features of Site SCADA and Regional SCADA</a></li><li><a href=#dcs-overview>DCS Overview</a></li><li><a href=#industrial-control-systems-ics>Industrial Control Systems (ICS)</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 binophism</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>